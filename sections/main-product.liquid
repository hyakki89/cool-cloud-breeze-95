{% assign current_variant = product.selected_or_first_available_variant %}
{% assign product_form_id = 'ProductForm-' | append: section.id %}

<style>
  /* Reset et base */
  * { box-sizing: border-box; }
  
  .zen-product-page {
    background: #f8fafc;
    background: linear-gradient(135deg, #f8fafc 0%, #dbeafe 50%, #f3e8ff 100%);
    min-height: 100vh;
    padding: 20px 10px;
  }
  
  .zen-container {
    max-width: 1200px;
    margin: 0 auto;
  }
  
  .zen-grid {
    display: grid;
    gap: 30px;
  }
  
  @media (min-width: 768px) {
    .zen-grid { grid-template-columns: 1fr 1fr; }
  }
  
  /* Images */
  .zen-image-section {
    display: flex;
    flex-direction: column;
    gap: 15px;
  }
  
  .zen-main-image-box {
    position: relative;
    background: white;
    border-radius: 15px;
    padding: 15px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
  }
  
  .zen-main-image {
    width: 100%;
    height: 300px;
    object-fit: cover;
    border-radius: 10px;
    display: block;
  }
  
  .zen-badges {
    position: absolute;
    top: 20px;
    left: 20px;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }
  
  .zen-badge {
    padding: 5px 12px;
    border-radius: 6px;
    font-size: 13px;
    font-weight: 600;
    color: white;
    display: inline-block;
  }
  
  .zen-badge-green { background: #22c55e; }
  .zen-badge-red { background: #ef4444; }
  .zen-badge-orange { background: #f97316; }
  
  .zen-thumbnails {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 8px;
  }
  
  .zen-thumb {
    border: 2px solid #e5e7eb;
    border-radius: 8px;
    overflow: hidden;
    cursor: pointer;
    transition: all 0.3s ease;
    background: none;
    padding: 0;
  }
  
  .zen-thumb:hover,
  .zen-thumb.active {
    border-color: #60a5fa;
    transform: scale(1.05);
  }
  
  .zen-thumb img {
    width: 100%;
    height: 60px;
    object-fit: cover;
    display: block;
  }
  
  /* Info section */
  .zen-info {
    display: flex;
    flex-direction: column;
    gap: 20px;
  }
  
  .zen-title {
    font-size: 28px;
    font-weight: 700;
    color: #1f2937;
    margin: 0;
    line-height: 1.2;
  }
  
  .zen-reviews {
    display: flex;
    align-items: center;
    gap: 10px;
    flex-wrap: wrap;
  }
  
  .zen-stars {
    color: #fbbf24;
    font-size: 18px;
  }
  
  .zen-price-box {
    background: white;
    border: 2px solid #93c5fd;
    border-radius: 15px;
    padding: 20px;
    text-align: center;
  }
  
  .zen-price-main {
    font-size: 36px;
    font-weight: 900;
    color: #1e40af;
    margin: 10px 0;
  }
  
  .zen-price-old {
    font-size: 20px;
    color: #9ca3af;
    text-decoration: line-through;
    margin-right: 10px;
  }
  
  .zen-savings {
    background: #dcfce7;
    color: #15803d;
    padding: 8px 15px;
    border-radius: 20px;
    font-weight: 600;
    display: inline-block;
    margin: 10px 0;
  }
  
  .zen-guarantees {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 10px;
    margin-top: 15px;
    font-size: 14px;
  }
  
  .zen-guarantee {
    display: flex;
    align-items: center;
    font-weight: 600;
  }
  
  /* Description */
  .zen-description {
    background: #eff6ff;
    border: 1px solid #93c5fd;
    border-radius: 15px;
    padding: 20px;
  }
  
  .zen-desc-text {
    font-size: 16px;
    line-height: 1.6;
    margin-bottom: 15px;
    color: #374151;
  }
  
  .zen-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
  }
  
  .zen-tag {
    padding: 5px 12px;
    border-radius: 20px;
    font-size: 13px;
    font-weight: 600;
  }
  
  .zen-tag-blue { background: #dbeafe; color: #1e40af; }
  .zen-tag-purple { background: #e9d5ff; color: #7c2d12; }
  .zen-tag-green { background: #dcfce7; color: #15803d; }
  
  /* Form */
  .zen-form {
    display: flex;
    flex-direction: column;
    gap: 15px;
  }
  
  .zen-form-group {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }
  
  .zen-label {
    font-weight: 600;
    color: #374151;
  }
  
  .zen-colors {
    display: flex;
    gap: 10px;
  }
  
  .zen-color {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    border: 3px solid transparent;
    cursor: pointer;
    transition: all 0.3s ease;
  }
  
  .zen-color:hover,
  .zen-color.active {
    border-color: #60a5fa;
    transform: scale(1.1);
  }
  
  .zen-color-white { background: white; border-color: #d1d5db !important; }
  .zen-color-black { background: #111827; }
  .zen-color-rose { background: #f472b6; }
  .zen-color-blue { background: #60a5fa; }
  
  .zen-quantity {
    display: flex;
    align-items: center;
    gap: 15px;
  }
  
  .zen-qty-btn {
    width: 40px;
    height: 40px;
    border: 2px solid #d1d5db;
    border-radius: 8px;
    background: white;
    font-size: 20px;
    font-weight: 700;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .zen-qty-btn:hover {
    background: #f9fafb;
    border-color: #60a5fa;
  }
  
  .zen-qty-display {
    width: 40px;
    text-align: center;
    font-weight: 600;
    font-size: 16px;
  }
  
  /* Buy button */
  .zen-buy-section {
    display: flex;
    flex-direction: column;
    gap: 15px;
  }
  
  .zen-urgency {
    background: #fef2f2;
    border: 1px solid #fca5a5;
    border-radius: 10px;
    padding: 15px;
    text-align: center;
  }
  
  .zen-urgency-title {
    color: #dc2626;
    font-weight: 700;
    margin-bottom: 5px;
  }
  
  .zen-urgency-text {
    color: #b91c1c;
    font-size: 14px;
  }
  
  .zen-buy-btn {
    width: 100%;
    background: linear-gradient(to right, #60a5fa, #f472b6);
    color: white;
    font-weight: 700;
    padding: 15px 20px;
    border-radius: 12px;
    font-size: 18px;
    border: none;
    cursor: pointer;
    transition: all 0.3s ease;
  }
  
  .zen-buy-btn:hover {
    background: linear-gradient(to right, #f472b6, #60a5fa);
    transform: translateY(-2px);
  }
  
  .zen-security {
    text-align: center;
    font-size: 14px;
    color: #6b7280;
    margin-top: 10px;
  }
</style>

<div class="zen-product-page">
  <div class="zen-container">
    <div class="zen-grid">
      
      <!-- Image Section -->
      <div class="zen-image-section">
        <div class="zen-main-image-box">
          {% assign featured_media = current_variant.featured_media | default: product.featured_media | default: product.media.first %}
          {% if featured_media %}
            <img
              id="main-product-image"
              src="{{ featured_media | image_url: width: 800 }}"
              alt="{{ product.title | escape }}"
              class="zen-main-image"
            />
          {% endif %}
          <div class="zen-badges">
            <span class="zen-badge zen-badge-green">‚ú® Nouveau</span>
            {% if current_variant.compare_at_price > current_variant.price %}
              {% assign discount_percent = current_variant.compare_at_price | minus: current_variant.price | times: 100 | divided_by: current_variant.compare_at_price | round %}
              <span class="zen-badge zen-badge-red">üî• -{{ discount_percent }}%</span>
            {% endif %}
            <span class="zen-badge zen-badge-orange">‚ö° Stock limit√©</span>
          </div>
        </div>
        
        <div class="zen-thumbnails">
          {% for media in product.media limit: 4 %}
            {% if media.media_type == 'image' %}
              <button
                type="button"
                onclick="changeMainImage('{{ media | image_url: width: 800 }}', {{ forloop.index0 }})"
                id="thumb-{{ forloop.index0 }}"
                class="zen-thumb"
              >
                <img src="{{ media | image_url: width: 200 }}" alt="Vue {{ forloop.index }}" />
              </button>
            {% endif %}
          {% endfor %}
        </div>
      </div>

      <!-- Info Section -->
      <div class="zen-info">
        <div>
          <h1 class="zen-title">{{ product.title }}</h1>
          <div class="zen-reviews">
            <div class="zen-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
            <span style="color: #6b7280; font-weight: 500;">(4.9/5 - 127 avis)</span>
            <div style="color: #22c55e; font-size: 14px; font-weight: 600;">‚úì +2,000 clients satisfaits</div>
          </div>
        </div>

        <!-- Price Card -->
        <div class="zen-price-box">
          <div>
            {% if current_variant.compare_at_price > current_variant.price %}
              <span class="zen-price-old">{{ current_variant.compare_at_price | money }}</span>
            {% endif %}
            <div id="price" class="zen-price-main">{{ current_variant.price | money }}</div>
            {% if current_variant.compare_at_price > current_variant.price %}
              {% assign savings = current_variant.compare_at_price | minus: current_variant.price %}
              {% assign savings_percent = savings | times: 100 | divided_by: current_variant.compare_at_price | round %}
              <div class="zen-savings">üí∞ √âconomisez {{ savings | money }} ({{ savings_percent }}%)</div>
            {% endif %}
          </div>
          
          <div class="zen-guarantees">
            <div class="zen-guarantee" style="color: #2563eb;">üöö Livraison gratuite</div>
            <div class="zen-guarantee" style="color: #9333ea;">‚ö° Exp√©dition 24h</div>
            <div class="zen-guarantee" style="color: #22c55e;">üõ°Ô∏è Garantie 30j</div>
            <div class="zen-guarantee" style="color: #f97316;">üîí Paiement s√©curis√©</div>
          </div>
        </div>

        <!-- Description -->
        <div class="zen-description">
          {% if product.description != blank %}
            <div class="zen-desc-text">{{ product.description }}</div>
          {% else %}
            <div class="zen-desc-text">
              üöÄ <strong>La bague connect√©e qui r√©volutionne ton quotidien !</strong> Contr√¥le tes r√©seaux sociaux, ta musique et tes photos d'un simple geste. 
              Design minimaliste et discret pour une technologie innovante √† port√©e de main.
            </div>
          {% endif %}
          <div class="zen-tags">
            <span class="zen-tag zen-tag-blue">üì± Compatible iOS/Android</span>
            <span class="zen-tag zen-tag-purple">üéµ Contr√¥le musical</span>
            <span class="zen-tag zen-tag-green">üì∏ Selfies √† distance</span>
          </div>
        </div>

        <!-- Product Form -->
        {% form 'product', product, id: product_form_id %}
          <input type="hidden" name="id" id="selected-variant-id" value="{{ current_variant.id }}">
          <div class="zen-form">
            {% unless product.has_only_default_variant %}
              {% for option in product.options_with_values %}
                <div class="zen-form-group">
                  <label class="zen-label">{{ option.name }} :</label>
                  {% if option.name == 'Couleur' or option.name == 'Color' %}
                    <div class="zen-colors">
                      {% for value in option.values %}
                        <input type="radio" name="options[{{ option.name | escape }}]" value="{{ value | escape }}" id="{{ section.id }}-{{ option.position }}-{{ forloop.index0 }}" style="display: none;" {% if option.selected_value == value %}checked{% endif %}>
                        <label for="{{ section.id }}-{{ option.position }}-{{ forloop.index0 }}" class="zen-color {% if value contains 'white' or value contains 'Blanc' %}zen-color-white{% elsif value contains 'black' or value contains 'Noir' %}zen-color-black{% elsif value contains 'rose' or value contains 'Rose' %}zen-color-rose{% elsif value contains 'blue' or value contains 'Bleu' %}zen-color-blue{% endif %}{% if option.selected_value == value %} active{% endif %}"></label>
                      {% endfor %}
                    </div>
                  {% else %}
                    <select name="options[{{ option.name | escape }}]" style="width: 100%; padding: 12px; border: 2px solid #d1d5db; border-radius: 12px; background: white;">
                      {% for value in option.values %}
                        <option value="{{ value | escape }}" {% if option.selected_value == value %}selected{% endif %}>{{ value }}</option>
                      {% endfor %}
                    </select>
                  {% endif %}
                </div>
              {% endfor %}
            {% endunless %}

            <div class="zen-form-group">
              <label class="zen-label">Quantit√© :</label>
              <div class="zen-quantity">
                <button type="button" onclick="changeQuantity(-1)" class="zen-qty-btn">-</button>
                <span id="quantity-display" class="zen-qty-display">1</span>
                <input type="hidden" name="quantity" id="quantity" value="1">
                <button type="button" onclick="changeQuantity(1)" class="zen-qty-btn">+</button>
              </div>
            </div>
          </div>

          <!-- Buy Now Section -->
          <div class="zen-buy-section">
            <div class="zen-urgency">
              <div class="zen-urgency-title">‚è∞ Offre limit√©e dans le temps !</div>
              <div class="zen-urgency-text">Plus que 12 unit√©s en stock - Commandez maintenant !</div>
            </div>
            
            <button type="submit" name="add" class="zen-buy-btn">
              ‚ö° Acheter maintenant - <span id="cta-price">{{ current_variant.price | money }}</span> ‚ö°
            </button>
            
            <div class="zen-security">
              ‚úÖ Paiement s√©curis√© ‚Ä¢ üì¶ Livraison rapide ‚Ä¢ üîÑ Retour gratuit 30j
            </div>
          </div>
        {% endform %}

      </div>
    </div>
  </div>
</div>

<script>
  function changeMainImage(src, index) {
    const mainImage = document.getElementById('main-product-image');
    if (mainImage) mainImage.src = src;
    
    // Update active thumbnail
    const thumbnails = document.querySelectorAll('.zen-thumb');
    thumbnails.forEach(thumb => thumb.classList.remove('active'));
    
    const activeThumb = document.getElementById('thumb-' + index);
    if (activeThumb) activeThumb.classList.add('active');
  }

  function changeQuantity(change) {
    const quantityInput = document.getElementById('quantity');
    const quantityDisplay = document.getElementById('quantity-display');
    if (!quantityInput || !quantityDisplay) return;
    
    const currentValue = parseInt(quantityInput.value || '1');
    const newValue = Math.max(1, Math.min(10, currentValue + change));
    quantityInput.value = newValue;
    quantityDisplay.textContent = newValue;
  }

  // Initialize on page load
  document.addEventListener('DOMContentLoaded', function() {
    // Set first thumbnail as active
    const firstThumb = document.getElementById('thumb-0');
    if (firstThumb) firstThumb.classList.add('active');

    // Handle variant changes
    const variants = {{ product.variants | json }};
    
    function updateVariant() {
      const selectedOptions = [];
      {% for option in product.options_with_values %}
        const option{{ forloop.index }} = document.querySelector('[name="options[{{ option.name | escape }}]"]:checked') || document.querySelector('select[name="options[{{ option.name | escape }}]"]');
        selectedOptions.push(option{{ forloop.index }} ? option{{ forloop.index }}.value : null);
      {% endfor %}
      
      const selectedVariant = variants.find(variant => {
        return selectedOptions.every((option, index) => {
          return !option || variant['option' + (index + 1)] === option;
        });
      });
      
      if (selectedVariant && typeof Shopify !== 'undefined' && Shopify.formatMoney) {
        document.getElementById('selected-variant-id').value = selectedVariant.id;
        const priceElement = document.getElementById('price');
        const ctaPriceElement = document.getElementById('cta-price');
        if (priceElement) priceElement.textContent = Shopify.formatMoney(selectedVariant.price, "{{ shop.money_format | replace: '"', '\\"' }}");
        if (ctaPriceElement) ctaPriceElement.textContent = Shopify.formatMoney(selectedVariant.price, "{{ shop.money_format | replace: '"', '\\"' }}");
      }
    }

    // Add event listeners to all variant selectors
    document.querySelectorAll('[name^="options["]').forEach(input => {
      input.addEventListener('change', function() {
        // Update color option active state
        if (this.type === 'radio' && (this.name.includes('Couleur') || this.name.includes('Color'))) {
          document.querySelectorAll('.zen-color').forEach(opt => opt.classList.remove('active'));
          document.querySelector('label[for="' + this.id + '"]').classList.add('active');
        }
        updateVariant();
      });
    });
  });
</script>